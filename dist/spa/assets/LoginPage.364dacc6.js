import{Q as c}from"./QInput.3a550fc5.js";import{M as p,N as m,O as l,P as a,Z as u,X as f}from"./index.bd582081.js";import{Q as g}from"./QForm.597ba3af.js";import{Q as h,a as w}from"./QCard.f983a58c.js";import{Q as b}from"./QPage.ff6a0c7c.js";import{u as k}from"./use-quasar.eedf8ecf.js";import{a as I}from"./api.52e83815.js";import{_ as y}from"./plugin-vue_export-helper.21dcd24c.js";import"./uid.937d8ee7.js";import"./use-dark.eb83277b.js";import"./axios.bf56c3c5.js";class i extends Error{}i.prototype.name="InvalidTokenError";function Q(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function v(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Q(e)}catch{return atob(e)}}function _(r,e){if(typeof r!="string")throw new i("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new i(`Invalid token specified: missing part #${t+1}`);let s;try{s=v(o)}catch(n){throw new i(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(s)}catch(n){throw new i(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}const q={data(){return{username:"",password:""}},methods:{async login(){try{const e=(await I.post("/login",{username:this.username,password:this.password})).data.token;this.$q.localStorage.setItem("token",e);const o=_(e).userId;this.$q.localStorage.setItem("userId",o),console.log("from local storage:",this.$q.localStorage.getItem("userId")),this.$router.push("/home")}catch(r){console.error("Login error:",r)}}},setup(){k()}};function S(r,e,t,o,s,n){return p(),m(b,{class:"q-pa-md"},{default:l(()=>[a(w,{class:"q-mb-md"},{default:l(()=>[a(h,null,{default:l(()=>[a(g,{onSubmit:u(n.login,["prevent"])},{default:l(()=>[a(c,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=d=>s.username=d),label:"Username",required:""},null,8,["modelValue"]),a(c,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=d=>s.password=d),label:"Password",type:"password",required:""},null,8,["modelValue"]),a(f,{type:"submit",label:"Login",color:"primary",class:"q-mt-md"})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})}var N=y(q,[["render",S]]);export{N as default};
